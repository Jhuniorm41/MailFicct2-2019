--  ------------------------------------------- 
--  Generated by Enterprise Architect Ver. 4.01
--  Created On : domingo, 05 mayo, 2019 
--  DBMS       :  
--  ------------------------------------------- 

-- PRIMERO EJECUTAR LOS DROPS
-- CREEN LA BASE DE DATOS db_grupo13sc
-- Ejecuten los drops
-- Ejecuten las secuencias
-- Ejecuten las tablas y sus llaves
-- Ejecuten los insert

DROP TABLE Garantia;
DROP TABLE Producto;
DROP TABLE Promocion;
DROP TABLE Servicio_Mantenimiento;
DROP TABLE Detalle_cotizacion;
DROP TABLE Tipo_producto;
DROP TABLE Cotizacion;
DROP TABLE Tipo_servicio;
DROP TABLE Reserva;
DROP TABLE Personal;
DROP TABLE Cliente;
DROP TABLE Usuario;

DROP SEQUENCE seq_garantia_id;
DROP SEQUENCE seq_producto_id;
DROP SEQUENCE seq_promocion_id;
DROP SEQUENCE seq_servicio_mantenimiento_id;
DROP SEQUENCE seq_detalle_cotizacion_id;
DROP SEQUENCE seq_tipo_producto_id;
DROP SEQUENCE seq_cotizacion_id;
DROP SEQUENCE seq_tipo_servicio_id;
DROP SEQUENCE seq_reserva_id;
DROP SEQUENCE seq_personal_id;
DROP SEQUENCE seq_cliente_id;
DROP SEQUENCE seq_usuario_id;


---------------------------
-- sequence structure for seq_persona_id
------------------------------
create sequence seq_garantia_id
start with 1
increment by 1
maxvalue 999999999999999999
minvalue 1;


----------------------------
-- sequence structure for seq_cliente_id
------------------------------
create sequence seq_producto_id
start with 1
increment by 1
maxvalue 999999999999999999
minvalue 1;

----------------------------
-- sequence structure for seq_proveedor_id
------------------------------
create sequence seq_promocion_id
start with 1
increment by 1
maxvalue 999999999999999999
minvalue 1;

----------------------------
-- sequence structure for seq_pedido_id
------------------------------
create sequence seq_servicio_mantenimiento_id
start with 1
increment by 1
maxvalue 999999999999999999
minvalue 1;

----------------------------
-- sequence structure for seq_entrega_id
------------------------------
create sequence seq_detalle_cotizacion_id
start with 1
increment by 1
maxvalue 999999999999999999
minvalue 1;

----------------------------
-- sequence structure for seq_tipo_entrega_id
------------------------------
create sequence seq_tipo_producto_id
start with 1
increment by 1
maxvalue 999999999999999999
minvalue 1;

----------------------------
-- sequence structure for seq_nota_venta_id
------------------------------
create sequence seq_cotizacion_id
start with 1
increment by 1
maxvalue 999999999999999999
minvalue 1;

----------------------------
-- sequence structure for seq_usuario_id
------------------------------
create sequence seq_tipo_servicio_id
start with 1
increment by 1
maxvalue 999999999999999999
minvalue 1;

----------------------------
-- sequence structure for seq_lote_id
------------------------------
create sequence seq_reserva_id
start with 1
increment by 1
maxvalue 999999999999999999
minvalue 1;

----------------------------
-- sequence structure for seq_almacen_id
------------------------------
create sequence seq_personal_id
start with 1
increment by 1
maxvalue 999999999999999999
minvalue 1;

----------------------------
-- sequence structure for seq_producto_id
------------------------------
create sequence seq_cliente_id
start with 1
increment by 1
maxvalue 999999999999999999
minvalue 1;

----------------------------
-- sequence structure for seq_detalle_pedido_id
------------------------------
create sequence seq_usuario_id
start with 1
increment by 1
maxvalue 999999999999999999
minvalue 1;


CREATE TABLE Usuario
(
	id bigint default nextval('seq_usuario_id'),
	username varchar(50) NOT NULL,
	contrasenia varchar(20) NOT NULL,
	estado boolean NOT NULL,
	UNIQUE (id)
)
;

CREATE TABLE Cliente
(
	id bigint default nextval('seq_cliente_id'),
	nit int NOT NULL,
	nombre varchar(50) NOT NULL,
	telefono varchar(11) NOT NULL,
	estado boolean NOT NULL,
	usuarioId bigint NOT NULL,
	UNIQUE (id)
)
;

CREATE TABLE Personal
(
	id bigint default nextval('seq_personal_id'),
	codigo varchar(15) NOT NULL,
	nombre varchar(50) NOT NULL,
    telefono varchar(11) NOT NULL,
    direccion varchar(20) NOT NULL,
	cargo varchar(30) NOT NULL,
	estado boolean NOT NULL,
	usuarioId bigint NOT NULL,
	UNIQUE (id)
)
;

CREATE TABLE Reserva
(
	id bigint default nextval('seq_reserva_id'),
	codigo varchar(15) NOT NULL,
	fecha_registro timestamp NOT NULL,
	fecha_reservada timestamp NOT NULL,
	estado boolean NOT NULL,
	clienteId bigint NOT NULL,
	UNIQUE (id)
)
;

CREATE TABLE Tipo_Servicio
(
	id bigint default nextval('seq_tipo_servicio_id'),
	codigo varchar(15) NOT NULL,
	nombre varchar(50) NOT NULL,
	estado boolean NOT NULL,
	UNIQUE (id)
)
;

CREATE TABLE Cotizacion
(
	id bigint default nextval('seq_cotizacion_id'),
	codigo varchar(15) NOT NULL,
	fecha_registro timestamp NOT NULL,
	monto decimal(10,2) NOT NULL,
	reservaId bigint NOT NULL,
	personalId bigint NOT NULL,
	estado boolean NOT NULL,
	UNIQUE (id)
)
;

CREATE TABLE Tipo_Producto
(
	id bigint default nextval('seq_tipo_producto_id'),
	codigo varchar(15) NOT NULL,
	nombre varchar(40) NOT NULL,
	estado boolean NOT NULL,
	UNIQUE (id)
)
;

CREATE TABLE Detalle_Cotizacion
(
	id bigint default nextval('seq_detalle_cotizacion_id'),
	tipoProductoId bigint NOT NULL,
	tipoServicioId bigint NOT NULL,
	estado boolean NOT NULL,
	cotizacionId bigint NOT NULL,
	cantidad int NOT NULL,
	subtotal decimal(10,2) NOT NULL,
	UNIQUE (id)
)
;

CREATE TABLE Servicio_Mantenimiento
(
	id bigint default nextval('seq_servicio_mantenimiento_id'),
	codigo varchar(15) NOT NULL,
	fecha_realizacion timestamp NOT NULL,
	estado boolean NOT NULL,
	monto decimal(10,2) NOT NULL,
	cotizacionId bigint NOT NULL,
	productoId bigint NOT NULL,
	UNIQUE (id)
)
;

CREATE TABLE Promocion
(
	id bigint default nextval('seq_promocion_id'),
	nombre varchar(20) NOT NULL,
	descuento int NOT NULL,
	fecha_inicio timestamp NOT NULL,
	fecha_fin timestamp NOT NULL,
	tipoServicioId bigint NOT NULL,
	tipoProductoId bigint NOT NULL,
	estado boolean NOT NULL,
	UNIQUE (id)
)
;

CREATE TABLE Producto
(
	id bigint default nextval('seq_producto_id'),
	codigo_nota_venta varchar(20) NOT NULL,
	codigo varchar(20) NOT NULL,
	marca varchar(40) NOT NULL,
	estado boolean NOT NULL,
	tipoProductoId bigint NOT NULL,
	clienteId bigint NOT NULL,
	UNIQUE (id)
)
;

CREATE TABLE Garantia
(
    id bigint default nextval('seq_garantia_id'),
	fecha_inicio timestamp NOT NULL,
	fecha_fin timestamp NOT NULL,
	fecha_ampliacion timestamp NULL,
	productoId bigint NOT NULL,
	estado boolean NOT NULL,
	UNIQUE (id)
)
;

ALTER TABLE Cliente ADD CONSTRAINT PK_cliente
PRIMARY KEY (id)
;
ALTER TABLE Personal ADD CONSTRAINT PK_personal
PRIMARY KEY (id)
;
ALTER TABLE Usuario ADD CONSTRAINT PK_usuario
PRIMARY KEY (id)
;
ALTER TABLE Reserva ADD CONSTRAINT PK_reserva
PRIMARY KEY (id)
;
ALTER TABLE Tipo_Servicio ADD CONSTRAINT PK_tipo_servicio
PRIMARY KEY (id)
;
ALTER TABLE Cotizacion ADD CONSTRAINT PK_cotizacion
PRIMARY KEY (id)
;
ALTER TABLE Tipo_Producto ADD CONSTRAINT PK_tipo_producto
PRIMARY KEY (id)
;
ALTER TABLE Detalle_Cotizacion ADD CONSTRAINT PK_detalle_cotizacion
PRIMARY KEY (id)
;
ALTER TABLE Servicio_Mantenimiento ADD CONSTRAINT PK_servicio_mantenimiento
PRIMARY KEY (id)
;
ALTER TABLE Promocion ADD CONSTRAINT PK_promocion
PRIMARY KEY (id)
;
ALTER TABLE Producto ADD CONSTRAINT PK_producto
PRIMARY KEY (id)
;
ALTER TABLE Garantia ADD CONSTRAINT PK_garantia
PRIMARY KEY (id)
;


ALTER TABLE  Cliente ADD CONSTRAINT FK_usuario_cliente
FOREIGN KEY (usuarioId) REFERENCES Usuario (id)
;
ALTER TABLE  Personal ADD CONSTRAINT FK_usuario_personal
FOREIGN KEY (usuarioId) REFERENCES Usuario (id)
;

ALTER TABLE  Reserva ADD CONSTRAINT FK_cliente_reserva
FOREIGN KEY (clienteId) REFERENCES Cliente (id)
;

ALTER TABLE  Cotizacion ADD CONSTRAINT FK_cotizacion_reserva
FOREIGN KEY (reservaId) REFERENCES Reserva (id)
;

ALTER TABLE  Cotizacion ADD CONSTRAINT FK_cotizacion_personal
FOREIGN KEY (personalId) REFERENCES Personal (id)
;

ALTER TABLE  Detalle_Cotizacion ADD CONSTRAINT FK_detalle_cotizacion
FOREIGN KEY (cotizacionId) REFERENCES Cotizacion (id)
;

ALTER TABLE  Detalle_Cotizacion ADD CONSTRAINT FK_detalle_tipo_producto
FOREIGN KEY (tipoProductoId) REFERENCES Tipo_Producto (id)
;
ALTER TABLE  Detalle_Cotizacion ADD CONSTRAINT FK_detalle_tipo_servicio
FOREIGN KEY (tipoServicioId) REFERENCES Tipo_Servicio (id)
;

ALTER TABLE  Producto ADD CONSTRAINT FK_producto_tipo_producto
FOREIGN KEY (tipoProductoID) REFERENCES Tipo_Producto (id)
;

ALTER TABLE  Garantia ADD CONSTRAINT FK_producto_garantia
FOREIGN KEY (productoId) REFERENCES Producto (id)
;

ALTER TABLE  Servicio_Mantenimiento ADD CONSTRAINT FK_servicio_mantenimiento_cotizacion
FOREIGN KEY (cotizacionId) REFERENCES Cotizacion (id)
;

ALTER TABLE  Servicio_Mantenimiento ADD CONSTRAINT FK_servicio_mantenimiento_producto
FOREIGN KEY (productoId) REFERENCES Producto (id)
;

ALTER TABLE  Promocion ADD CONSTRAINT FK_promocion_tipo_servicio
FOREIGN KEY (tipoServicioId) REFERENCES Tipo_Servicio (id)
;

ALTER TABLE  Promocion ADD CONSTRAINT FK_promocion_tipo_producto
FOREIGN KEY (tipoProductoId) REFERENCES Tipo_Producto (id)
;


